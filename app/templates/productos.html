{% extends './plantillaindex.html' %}

{% block titulo %}{{ datosApp.titulo }}{% endblock %}

{% block LinkAdicional %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/Productos.css') }}">
{% endblock %}

{% block body %}
<div class="container">
    <!-- Contenido principal -->
    <div class="main-content">
        <h2>Productos Disponibles</h2>
        <div class="productos">
            <!-- Productos generados dinámicamente -->
            {% if datosApp.productos %}
            {% for producto in datosApp.productos %}
            <div class="producto" data-id="{{ producto['id'] }}" data-name="{{ producto['nombre'] }}"
                data-price="{{ producto['precio'] }}" data-reference="{{ producto['referencia'] }}"
                data-gender="{{ producto.get('genero', '') }}" data-description="{{ producto['descripcion'] }}"
                data-image="{{ producto['imagen'] }}" data-stock="{{ producto['stock'] }}">

                {% if producto['stock'] == 0 %}
                <div
                    style="position: absolute; top: 10px; right: 10px; background: red; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold; font-size: 0.9em; z-index: 10;">
                    AGOTADO</div>
                <img src="{{ producto['imagen'] }}" alt="{{ producto['nombre'] }}"
                    style="width: 100%; border-radius: 8px; margin-bottom: 10px; opacity: 0.6; filter: grayscale(100%);">
                {% else %}
                <img src="{{ producto['imagen'] }}" alt="{{ producto['nombre'] }}"
                    style="width: 100%; border-radius: 8px; margin-bottom: 10px;">
                {% endif %}

                <h3>{{ producto['nombre'] }}</h3>
                <p>{{ producto['precio_fmt'] }}</p>

                <p class="stock-info" style="font-size: 0.9em; color: #666; margin-bottom: 5px;">
                    Disponibles: <span
                        style="font-weight: bold; color: {{ 'red' if producto['stock'] < 5 else 'green' }}">{{
                        producto['stock'] }}</span>
                </p>

                {% if producto['stock'] > 0 %}
                <button class="añadir-carrito">Añadir al carrito</button>
                {% else %}
                <button class="agotado-btn" disabled
                    style="background-color: #ccc; cursor: not-allowed;">Agotado</button>
                {% endif %}

                <button class="ver-descripcion">Ver Detalles</button> <!-- Botón para ver los detalles -->
            </div>
            {% endfor %}
            {% else %}
            <p>No hay productos disponibles.</p>
            {% endif %}
        </div>
    </div>


    <!-- Pop-up para los detalles del producto -->
    <div id="popup-descripcion" class="popup">
        <div class="popup-contenido">
            <span class="cerrar-popup">&times;</span>
            <img id="popup-imagen" src="" alt="Imagen del producto"
                style="width: 100%; border-radius: 8px; margin-bottom: 10px;">
            <h2 id="popup-titulo"></h2>
            <p><strong>Referencia:</strong> <span id="popup-referencia"></span></p>
            <p><strong>Género:</strong> <span id="popup-genero"></span></p>
            <p><strong>Descripción:</strong> <span id="popup-descripcion-texto"></span></p>
            <p><strong>Precio:</strong><span id="popup-precio"></span></p>
        </div>
    </div>
</div>


<div id="loader"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;">
    <div style="background: white; padding: 20px; border-radius: 5px;">
        <p>Procesando pago...</p>
        <div class="spinner"></div>
    </div>
</div>


{% endblock %}